name: Update PR summary

on:
  workflow_run:
    workflows: [CI]
    types: [completed]

jobs:
    static-analysis:
        name: Static analysis
        runs-on: ubuntu-latest
        permissions:
          actions: read
          contents: read
          pull-requests: write
        steps:
          - uses: actions/checkout@v4
            with:
              submodules: recursive
    
          - name: Analyze using Slither
            uses: crytic/slither-action@v0.3.1
            id: slither
            with:
              sarif: results.sarif
              node-version: '20.10'
              fail-on: none
              slither-args: --checklist --markdown-root ${{ github.server_url }}/${{ github.repository }}/blob/${{ github.sha }}/
    
          - name: Create/update checklist as PR comment
            uses: actions/github-script@v7
            if: github.event_name == 'pull_request'
            env:
              REPORT: ${{ steps.slither.outputs.stdout }}
            with:
              script: |
                // const script = require('.github/scripts/comment')
                // const header = '# Slither report'
                // const body = process.env.REPORT
                // await script({ github, context, header, body })
                github.rest.issues.createComment({
                  issue_number: context.issue.number,
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  body: process.env.REPORT
                })
    

            







